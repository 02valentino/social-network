{% extends 'base.html' %}
{% load static %}

{% block content %}
  {% if profile_user.profile_picture %}
    <img src="{{ profile_user.profile_picture.url }}" alt="Profile Picture">
  {% else %}
    <img src="{% static 'images/default_profile.png' %}" alt="Default Profile" style="width:100px;height:100px;">
  {% endif %}

  <h2>{{ profile_user.first_name }} {{ profile_user.last_name }}</h2>
  <h3>@{{ profile_user.username }}</h3>

  <p><strong>Posts:</strong> {{ posts_count }}</p>
  <p>
    <strong>
      <a href="{% url 'user-friends' username=profile_user.username %}">
        Friends: {{ friends_count|default:0 }}
      </a>
    </strong>
  </p>

  {% if profile_user.bio %}
    <p><strong>Bio:</strong> {{ profile_user.bio }}</p>
  {% endif %}

  {% if profile_user.birthday %}
    <p><strong>Birthday:</strong> {{ profile_user.birthday }}</p>
  {% endif %}

  {% if profile_user.location %}
    <p><strong>Location:</strong> {{ profile_user.location }}</p>
  {% endif %}

  {% if user.is_authenticated and user == profile_user %}
    <p><strong>Email:</strong> {{ profile_user.email }}</p>
    <p><strong>Joined:</strong> {{ profile_user.date_joined }}</p>
    <p><a href="{% url 'edit-profile' %}">Edit Profile</a></p>
  {% endif %}

  {% if user.is_authenticated and user != profile_user %}
    {% if is_friend %}
      <form action="{% url 'unfriend-user' profile_user.username %}" method="post">
        {% csrf_token %}
        <button type="submit">Unfriend</button>
      </form>
    {% elif request_received %}
      <form action="{% url 'accept-friend-request' profile_user.username %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit">Accept</button>
      </form>
      <form action="{% url 'decline-friend-request' profile_user.username %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit">Decline</button>
      </form>
    {% elif request_sent %}
      <form action="{% url 'cancel-friend-request' profile_user.username %}" method="post">
        {% csrf_token %}
        <button type="submit">Cancel Request</button>
      </form>
    {% else %}
      <form action="{% url 'send-friend-request' profile_user.username %}" method="post">
        {% csrf_token %}
        <button type="submit">Add Friend</button>
      </form>
    {% endif %}
  {% endif %}

  {% if user == profile_user or is_friend %}
    <h3>Posts by {{ profile_user.username }}</h3>
    {% if posts %}
      <ul>
        {% for post in posts %}
          {% if user == post.author %}
            <a href="{% url 'edit-post' post.pk %}">Edit</a>
            <a href="{% url 'delete-post' post.pk %}">Delete</a>
          {% endif %}
          <li>
            {{ post.content }} <em>â€” {{ post.posted_at|date:"M d, Y H:i" }}</em>
          </li>

          {% include "network/partials/like_button.html" with post=post %}

          <a href="{% url 'post-detail' post.pk %}">
            <button type="button">Comment</button>
          </a>
          <a href="{% url 'post-detail' post.pk %}">{{ post.comment_count }} comments</a>
        {% endfor %}
      </ul>
    {% else %}
      <p>No posts yet.</p>
    {% endif %}
  {% else %}
    <p><em>You must be friends with {{ profile_user.username }} to view their posts.</em></p>
  {% endif %}
{% endblock %}
