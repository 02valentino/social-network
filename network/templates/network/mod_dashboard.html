{% extends 'base.html' %}
{% load humanize %}

{% block content %}
  <h2>Moderator Dashboard</h2>

  <h3>All Regular Users</h3>
  <table>
    <thead>
      <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
        <tr>
          <td><a href="{% url 'profile' user.username %}">{{ user.username }}</a></td>
          <td>{{ user.email }}</td>
          <td>
            {% if user.is_banned %}
              <span>Banned</span>
            {% else %}
              Active
            {% endif %}
          </td>
          <td>
            {% if user != request.user %}
              <form method="post" action="{% url 'toggle-ban' user.id %}">
                {% csrf_token %}
                <button type="submit">
                  {% if user.is_banned %}Unban{% else %}Ban{% endif %}
                </button>
              </form>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <h3>All Posts by Regular Users</h3>
  <ul>
    {% for post in posts %}
      <li>
        <strong><a href="{% url 'profile' post.author.username %}">{{ post.author.username }}</a></strong>:
        {{ post.content|linebreaks }}
        <small style="color: gray;">({{ post.posted_at|naturaltime }})</small>
        <form method="post" action="{% url 'delete-post' post.id %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit">Delete</button>
        </form>
      </li>
    {% endfor %}
  </ul>
{% endblock %}
